<section>
  <div class="container services">
    <h4 class="title">{{ 'CHARITY_ORGANIZATIONS.TITLE' | translate }}</h4>

    <!-- Loading State -->
    <div *ngIf="loading" class="text-center py-5">
      <div class="spinner-border" role="status">
        <span class="visually-hidden">{{ 'COMMON.LOADING' | translate }}</span>
      </div>
      <p class="mt-3">{{ 'COMMON.LOADING_DATA' | translate }}</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="text-center py-5">
      <div class="alert alert-danger" role="alert">
        <h5>{{ 'COMMON.ERROR' | translate }}</h5>
        <p>{{ error | translate }}</p>
        <button class="btn btn-primary" (click)="retryLoad()">
          {{ 'COMMON.REFRESH' | translate }}
        </button>
      </div>
    </div>

    <!-- Content -->
    <div *ngIf="!loading && !error" class="row">
      <div *ngFor="let entity of entities" class="col-xl-4 col-lg-6 mb-4">
        <div class="service-box h-100" (click)="onEntityClick(entity)">
          <div class="mb-3">
            <img [src]="getEntityImage(entity)" [alt]="getEntityName(entity)" class="w-100 entity-image"
              (error)="onImageError($event)">
          </div>
          <span class="mb-3 ">{{ getEntityName(entity) }}</span>
          <!-- Dynamic Donation Status -->
          <div class="mb-3" [ngClass]="getDonationStatus(entity).allowed ? 'tag-2' : 'tag-1'">
            <!-- Not Allowed Icon -->
            <svg *ngIf="!getDonationStatus(entity).allowed" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 17 16" fill="none">
              <g clip-path="url(#clip0_632_11828)">
                <path d="M11.333 5.33386C11.2079 5.20888 11.0384 5.13867 10.8616 5.13867C10.6849 5.13867 10.5153 5.20888 10.3903 5.33386L8.6663 7.05786L6.94231 5.33386C6.81657 5.21242 6.64817 5.14523 6.47337 5.14675C6.29858 5.14827 6.13137 5.21838 6.00776 5.34198C5.88416 5.46559 5.81404 5.6328 5.81253 5.8076C5.81101 5.98239 5.8782 6.15079 5.99964 6.27653L7.72364 8.00053L5.99964 9.72453C5.8782 9.85026 5.81101 10.0187 5.81253 10.1935C5.81404 10.3683 5.88416 10.5355 6.00776 10.6591C6.13137 10.7827 6.29858 10.8528 6.47337 10.8543C6.64817 10.8558 6.81657 10.7886 6.94231 10.6672L8.6663 8.9432L10.3903 10.6672C10.516 10.7886 10.6844 10.8558 10.8592 10.8543C11.034 10.8528 11.2012 10.7827 11.3248 10.6591C11.4484 10.5355 11.5186 10.3683 11.5201 10.1935C11.5216 10.0187 11.4544 9.85026 11.333 9.72453L9.60897 8.00053L11.333 6.27653C11.4579 6.15151 11.5282 5.98197 11.5282 5.8052C11.5282 5.62842 11.4579 5.45888 11.333 5.33386Z" fill="#CA4832"/>
                <path d="M8.66602 0C7.08377 0 5.53705 0.469192 4.22146 1.34824C2.90586 2.22729 1.88048 3.47672 1.27498 4.93853C0.669482 6.40034 0.511055 8.00888 0.819737 9.56072C1.12842 11.1126 1.89034 12.538 3.00917 13.6569C4.12799 14.7757 5.55345 15.5376 7.1053 15.8463C8.65715 16.155 10.2657 15.9965 11.7275 15.391C13.1893 14.7855 14.4387 13.7602 15.3178 12.4446C16.1968 11.129 16.666 9.58225 16.666 8C16.6637 5.87897 15.8201 3.84547 14.3203 2.34568C12.8205 0.845886 10.787 0.00229405 8.66602 0V0ZM8.66602 14.6667C7.34748 14.6667 6.05855 14.2757 4.96222 13.5431C3.86589 12.8106 3.01141 11.7694 2.50682 10.5512C2.00224 9.33305 1.87022 7.99261 2.12745 6.6994C2.38469 5.40619 3.01962 4.21831 3.95197 3.28596C4.88432 2.3536 6.07221 1.71867 7.36542 1.46143C8.65862 1.2042 9.99907 1.33622 11.2172 1.8408C12.4354 2.34539 13.4766 3.19987 14.2092 4.2962C14.9417 5.39253 15.3327 6.68146 15.3327 8C15.3307 9.76752 14.6277 11.4621 13.3779 12.7119C12.1281 13.9617 10.4335 14.6647 8.66602 14.6667V14.6667Z" fill="#CA4832"/>
              </g>
              <defs>
                <clipPath id="clip0_632_11828">
                  <rect width="16" height="16" fill="white" transform="translate(0.666016)"/>
                </clipPath>
              </defs>
            </svg>
            
            <!-- Allowed Icon -->
            <svg *ngIf="getDonationStatus(entity).allowed" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none">
              <g clip-path="url(#clip0_638_1814)">
                <path d="M9.75965 16.3209C10.0026 16.4214 10.263 16.4731 10.526 16.4729C10.7868 16.4739 11.0452 16.4234 11.2865 16.3244C11.5277 16.2254 11.7471 16.0798 11.932 15.8959L18.725 9.18887C18.8971 8.99984 18.9903 8.75207 18.9854 8.49647C18.9805 8.24087 18.8779 7.99685 18.6987 7.81455C18.5194 7.63225 18.2772 7.52552 18.0217 7.51628C17.7663 7.50704 17.5169 7.59599 17.325 7.76487L10.519 14.4649L6.726 10.7579C6.53637 10.5722 6.28076 10.4695 6.0154 10.4723C5.75003 10.4751 5.49665 10.5832 5.311 10.7729C5.12535 10.9625 5.02263 11.2181 5.02545 11.4835C5.02826 11.7488 5.13637 12.0022 5.326 12.1879L9.11 15.8869C9.29592 16.0728 9.51668 16.2203 9.75965 16.3209Z" fill="#8D734D"/>
                <path d="M12 0C9.62663 0 7.30655 0.703788 5.33316 2.02236C3.35977 3.34094 1.8217 5.21509 0.913451 7.4078C0.00519943 9.60051 -0.232441 12.0133 0.230582 14.3411C0.693605 16.6689 1.83649 18.8071 3.51472 20.4853C5.19295 22.1635 7.33115 23.3064 9.65892 23.7694C11.9867 24.2324 14.3995 23.9948 16.5922 23.0866C18.7849 22.1783 20.6591 20.6402 21.9776 18.6668C23.2962 16.6935 24 14.3734 24 12C23.9966 8.81846 22.7312 5.76821 20.4815 3.51852C18.2318 1.26883 15.1815 0.00344108 12 0V0ZM12 22C10.0222 22 8.08879 21.4135 6.4443 20.3147C4.79981 19.2159 3.51809 17.6541 2.76121 15.8268C2.00433 13.9996 1.8063 11.9889 2.19215 10.0491C2.578 8.10929 3.53041 6.32746 4.92894 4.92893C6.32746 3.53041 8.10929 2.578 10.0491 2.19215C11.9889 1.8063 13.9996 2.00433 15.8268 2.76121C17.6541 3.51808 19.2159 4.79981 20.3147 6.4443C21.4135 8.08879 22 10.0222 22 12C21.9971 14.6513 20.9426 17.1931 19.0679 19.0679C17.1931 20.9426 14.6513 21.9971 12 22V22Z" fill="#8D734D"/>
              </g>
              <defs>
                <clipPath id="clip0_638_1814">
                  <rect width="24" height="24" fill="white"/>
                </clipPath>
              </defs>
            </svg>
            <span>{{ getDonationStatus(entity).text }}</span>
          </div>

          <!-- Description -->
          <div *ngIf="getEntityDescription(entity)" class="mb-3">
            <p class="entity-description text-muted small">{{ getEntityDescription(entity) }}</p>
          </div>
          <!-- Contact Information -->
          <div *ngIf="hasContactInfo(entity)" class="d-flex gap-2 mt-auto flex-wrap">

            <!-- Phone -->
            <div *ngIf="getEntityPhone(entity)" class="meta-line">
              <a [href]="'tel:' + getEntityPhone(entity)" dir="ltr" (click)="$event.stopPropagation()"
                class="organization-links" [title]="getEntityPhone(entity)">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <g clip-path="url(#clip0_581_2019)">
                    <path
                      d="M13 0.999644C13 0.734427 13.1053 0.480073 13.2929 0.292537C13.4804 0.105001 13.7348 -0.000356157 14 -0.000356157C16.6512 0.00255544 19.1931 1.05706 21.0678 2.93179C22.9425 4.80653 23.997 7.34837 24 9.99965C24 10.2649 23.8946 10.5192 23.7071 10.7068C23.5195 10.8943 23.2652 10.9996 23 10.9996C22.7347 10.9996 22.4804 10.8943 22.2929 10.7068C22.1053 10.5192 22 10.2649 22 9.99965C21.9976 7.87864 21.154 5.8452 19.6542 4.34542C18.1544 2.84565 16.121 2.00203 14 1.99964C13.7348 1.99964 13.4804 1.89429 13.2929 1.70675C13.1053 1.51921 13 1.26486 13 0.999644V0.999644ZM14 5.99964C15.0608 5.99964 16.0782 6.42107 16.8284 7.17122C17.5785 7.92136 18 8.93878 18 9.99965C18 10.2649 18.1053 10.5192 18.2929 10.7068C18.4804 10.8943 18.7347 10.9996 19 10.9996C19.2652 10.9996 19.5195 10.8943 19.7071 10.7068C19.8946 10.5192 20 10.2649 20 9.99965C19.9984 8.40883 19.3657 6.88363 18.2408 5.75876C17.116 4.63388 15.5908 4.00123 14 3.99964C13.7348 3.99964 13.4804 4.105 13.2929 4.29254C13.1053 4.48007 13 4.73443 13 4.99964C13 5.26486 13.1053 5.51921 13.2929 5.70675C13.4804 5.89429 13.7348 5.99964 14 5.99964V5.99964ZM23.093 16.7386C23.6725 17.3198 23.9979 18.107 23.9979 18.9276C23.9979 19.7483 23.6725 20.5355 23.093 21.1166L22.183 22.1656C13.993 30.0066 -5.93701 10.0816 1.78298 1.86564L2.93298 0.865644C3.51475 0.302321 4.29491 -0.00930708 5.10468 -0.00182132C5.91446 0.00566445 6.68872 0.331662 7.25998 0.905644C7.29098 0.936644 9.14397 3.34364 9.14397 3.34364C9.6938 3.92127 9.99988 4.68857 9.99857 5.48605C9.99727 6.28352 9.68869 7.04982 9.13697 7.62564L7.97898 9.08165C8.61982 10.6388 9.56204 12.0539 10.7515 13.2457C11.9409 14.4376 13.3542 15.3827 14.91 16.0266L16.375 14.8616C16.9509 14.3104 17.717 14.0021 18.5143 14.001C19.3115 13.9999 20.0785 14.306 20.656 14.8556C20.656 14.8556 23.062 16.7076 23.093 16.7386ZM21.717 18.1926C21.717 18.1926 19.324 16.3516 19.293 16.3206C19.0869 16.1164 18.8086 16.0018 18.5185 16.0018C18.2283 16.0018 17.95 16.1164 17.744 16.3206C17.717 16.3486 15.7 17.9556 15.7 17.9556C15.564 18.0638 15.4023 18.1348 15.2306 18.1614C15.0589 18.1881 14.8833 18.1695 14.721 18.1076C12.7054 17.3572 10.8747 16.1824 9.35281 14.6627C7.83091 13.1431 6.65338 11.3141 5.89998 9.29965C5.83318 9.1351 5.8114 8.95573 5.83688 8.77998C5.86237 8.60423 5.93419 8.43844 6.04498 8.29965C6.04498 8.29965 7.65198 6.28164 7.67898 6.25564C7.88324 6.04963 7.99786 5.77126 7.99786 5.48114C7.99786 5.19103 7.88324 4.91266 7.67898 4.70664C7.64798 4.67664 5.80698 2.28164 5.80698 2.28164C5.59788 2.09415 5.32498 1.99374 5.04423 2.00099C4.76347 2.00824 4.49612 2.12261 4.29698 2.32064L3.14698 3.32064C-2.49501 10.1046 14.776 26.4176 20.721 20.7996L21.632 19.7496C21.8454 19.5519 21.9737 19.2789 21.9895 18.9883C22.0054 18.6978 21.9076 18.4125 21.717 18.1926V18.1926Z"
                      fill="#374957" />
                  </g>
                  <defs>
                    <clipPath id="clip0_581_2019">
                      <rect width="24" height="24" fill="white" />
                    </clipPath>
                  </defs>
                </svg>
                <p style="margin: 0; font-weight: bold;">{{ getEntityPhone(entity) }}</p>
              </a>
            </div>

            <!-- Website -->
            <div *ngIf="getEntityWebsite(entity)" class="meta-line">
              <a [href]="normalizeUrl(getEntityWebsite(entity))" target="_blank" rel="noopener" dir="ltr"
                (click)="$event.stopPropagation()" class="organization-links" [title]="getEntityWebsite(entity)">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <g clip-path="url(#clip0_581_2021)">
                    <path
                      d="M12 0C9.62663 0 7.30655 0.703788 5.33316 2.02236C3.35977 3.34094 1.8217 5.21509 0.913451 7.4078C0.00519943 9.60051 -0.232441 12.0133 0.230582 14.3411C0.693605 16.6689 1.83649 18.8071 3.51472 20.4853C5.19295 22.1635 7.33115 23.3064 9.65892 23.7694C11.9867 24.2324 14.3995 23.9948 16.5922 23.0866C18.7849 22.1783 20.6591 20.6402 21.9776 18.6668C23.2962 16.6935 24 14.3734 24 12C23.9966 8.81846 22.7312 5.76821 20.4815 3.51852C18.2318 1.26883 15.1815 0.00344108 12 0V0ZM20.647 7H17.426C16.705 5.32899 15.7556 3.76609 14.605 2.356C17.1515 3.04893 19.3223 4.71747 20.647 7V7ZM16.5 12C16.4918 13.0181 16.3314 14.0293 16.024 15H7.97601C7.66866 14.0293 7.50821 13.0181 7.50001 12C7.50821 10.9819 7.66866 9.97068 7.97601 9H16.024C16.3314 9.97068 16.4918 10.9819 16.5 12V12ZM8.77801 17H15.222C14.3732 18.6757 13.2882 20.2208 12 21.588C10.7114 20.2212 9.62625 18.676 8.77801 17V17ZM8.77801 7C9.62677 5.32427 10.7119 3.77916 12 2.412C13.2886 3.77877 14.3738 5.32396 15.222 7H8.77801ZM9.40001 2.356C8.24766 3.76578 7.29659 5.3287 6.57401 7H3.35301C4.67886 4.71643 6.85166 3.04775 9.40001 2.356V2.356ZM2.46101 9H5.90001C5.64076 9.97915 5.50636 10.9871 5.50001 12C5.50636 13.0129 5.64076 14.0209 5.90001 15H2.46101C1.84635 13.0472 1.84635 10.9528 2.46101 9V9ZM3.35301 17H6.57401C7.29659 18.6713 8.24766 20.2342 9.40001 21.644C6.85166 20.9522 4.67886 19.2836 3.35301 17V17ZM14.605 21.644C15.7556 20.2339 16.705 18.671 17.426 17H20.647C19.3223 19.2825 17.1515 20.9511 14.605 21.644V21.644ZM21.539 15H18.1C18.3592 14.0209 18.4936 13.0129 18.5 12C18.4936 10.9871 18.3592 9.97915 18.1 9H21.537C22.1517 10.9528 22.1517 13.0472 21.537 15H21.539Z"
                      fill="#374957" />
                  </g>
                  <defs>
                    <clipPath id="clip0_581_2021">
                      <rect width="24" height="24" fill="white" />
                    </clipPath>
                  </defs>
                </svg>
              </a>
            </div>

            <!-- Location -->
            <div *ngIf="getEntityLocation(entity)" class="meta-line">
              <a [href]="normalizeUrl(getEntityLocation(entity))" target="_blank" rel="noopener" dir="ltr"
                (click)="$event.stopPropagation()" class="organization-links" [title]="getEntityLocation(entity)">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <g clip-path="url(#clip0_581_2016)">
                    <path
                      d="M12 6C11.2089 6 10.4355 6.2346 9.77772 6.67412C9.11993 7.11365 8.60723 7.73836 8.30448 8.46927C8.00173 9.20017 7.92252 10.0044 8.07686 10.7804C8.2312 11.5563 8.61216 12.269 9.17157 12.8284C9.73098 13.3878 10.4437 13.7688 11.2196 13.9231C11.9956 14.0775 12.7998 13.9983 13.5307 13.6955C14.2616 13.3928 14.8864 12.8801 15.3259 12.2223C15.7654 11.5645 16 10.7911 16 10C16 8.93913 15.5786 7.92172 14.8284 7.17157C14.0783 6.42143 13.0609 6 12 6ZM12 12C11.6044 12 11.2178 11.8827 10.8889 11.6629C10.56 11.4432 10.3036 11.1308 10.1522 10.7654C10.0009 10.3999 9.96126 9.99778 10.0384 9.60982C10.1156 9.22186 10.3061 8.86549 10.5858 8.58579C10.8655 8.30608 11.2219 8.1156 11.6098 8.03843C11.9978 7.96126 12.3999 8.00087 12.7654 8.15224C13.1308 8.30362 13.4432 8.55996 13.6629 8.88886C13.8827 9.21776 14 9.60444 14 10C14 10.5304 13.7893 11.0391 13.4142 11.4142C13.0391 11.7893 12.5304 12 12 12Z"
                      fill="#374957" />
                    <path
                      d="M12.0003 24.0001C11.1583 24.0044 10.3274 23.8069 9.57738 23.4241C8.82733 23.0413 8.17991 22.4844 7.68931 21.8C3.87831 16.543 1.94531 12.591 1.94531 10.053C1.94531 7.3863 3.00468 4.82877 4.89035 2.94309C6.77603 1.05741 9.33356 -0.00195312 12.0003 -0.00195312C14.6671 -0.00195312 17.2246 1.05741 19.1103 2.94309C20.9959 4.82877 22.0553 7.3863 22.0553 10.053C22.0553 12.591 20.1223 16.543 16.3113 21.8C15.8207 22.4844 15.1733 23.0413 14.4232 23.4241C13.6732 23.8069 12.8424 24.0044 12.0003 24.0001V24.0001ZM12.0003 2.18105C9.91273 2.18343 7.91133 3.01377 6.43518 4.48992C4.95904 5.96606 4.12869 7.96746 4.12631 10.055C4.12631 12.065 6.01931 15.782 9.45531 20.5211C9.74701 20.9228 10.1297 21.2498 10.572 21.4753C11.0144 21.7008 11.5038 21.8183 12.0003 21.8183C12.4968 21.8183 12.9863 21.7008 13.4286 21.4753C13.8709 21.2498 14.2536 20.9228 14.5453 20.5211C17.9813 15.782 19.8743 12.065 19.8743 10.055C19.8719 7.96746 19.0416 5.96606 17.5654 4.48992C16.0893 3.01377 14.0879 2.18343 12.0003 2.18105V2.18105Z"
                      fill="#374957" />
                  </g>
                  <defs>
                    <clipPath id="clip0_581_2016">
                      <rect width="24" height="24" fill="white" />
                    </clipPath>
                  </defs>
                </svg>
              </a>
            </div>

            <!-- Email -->
            <div *ngIf="getEntityEmail(entity)" class="meta-line">
              <a [href]="'mailto:' + getEntityEmail(entity)" (click)="$event.stopPropagation()" 
                class="organization-links" [title]="getEntityEmail(entity)">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <path
                    d="M19 1H5C3.6744 1.00159 2.40356 1.52888 1.46622 2.46622C0.528882 3.40356 0.00158786 4.6744 0 6L0 18C0.00158786 19.3256 0.528882 20.5964 1.46622 21.5338C2.40356 22.4711 3.6744 22.9984 5 23H19C20.3256 22.9984 21.5964 22.4711 22.5338 21.5338C23.4711 20.5964 23.9984 19.3256 24 18V6C23.9984 4.6744 23.4711 3.40356 22.5338 2.46622C21.5964 1.52888 20.3256 1.00159 19 1V1ZM5 3H19C19.5988 3.00118 20.1835 3.18151 20.679 3.5178C21.1744 3.85409 21.5579 4.33095 21.78 4.887L14.122 12.546C13.5584 13.1073 12.7954 13.4225 12 13.4225C11.2046 13.4225 10.4416 13.1073 9.878 12.546L2.22 4.887C2.44215 4.33095 2.82561 3.85409 3.32105 3.5178C3.81648 3.18151 4.40121 3.00118 5 3V3ZM19 21H5C4.20435 21 3.44129 20.6839 2.87868 20.1213C2.31607 19.5587 2 18.7956 2 18V7.5L8.464 13.96C9.40263 14.8963 10.6743 15.422 12 15.422C13.3257 15.422 14.5974 14.8963 15.536 13.96L22 7.5V18C22 18.7956 21.6839 19.5587 21.1213 20.1213C20.5587 20.6839 19.7956 21 19 21Z"
                    fill="#374957" />
                </svg>
              </a>
            </div>
          </div>

          <!-- No Contact Info Message -->
          <div *ngIf="!hasContactInfo(entity)" class="text-muted small mt-auto">
            {{ 'CHARITY_ORGANIZATIONS.NO_CONTACT_INFO' | translate }}
          </div>




          <div class="d-flex justify-content-end">
            <!-- <button class="btn btn-link">
              {{ 'COMMON.VIEW' | translate }}
              <svg xmlns="http://www.w3.org/2000/svg" width="7" height="12" viewBox="0 0 7 12" fill="none">
                <path d="M1.1665 11L6.1665 6L1.1665 1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
            </button> -->
          </div>
        </div>
      </div>
    </div>

    <!-- No Data State -->
    <div *ngIf="!loading && !error && entities.length === 0" class="text-center py-5">
      <div class="alert alert-info" role="alert">
        <h5>{{ 'CHARITY_ORGANIZATIONS.NO_ORGANIZATIONS' | translate }}</h5>
        <p>{{ 'CHARITY_ORGANIZATIONS.NO_ORGANIZATIONS_DESCRIPTION' | translate }}</p>
      </div>
    </div>
  </div>
</section>